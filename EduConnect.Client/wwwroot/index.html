<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduConnect</title>
    <base href="/" />
  
    <!-- ======= FONT & ICONS ======= -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- ======= BOOTSTRAP CORE ======= -->
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />

    <!-- ======= SITE STYLES ======= -->
    <link href="css/site.css" rel="stylesheet" />
    <link href="css/auth.css" rel="stylesheet" />
    <link href="css/register.css" rel="stylesheet" />

    <link href="css/custom.css" rel="stylesheet" />


    <!-- ======= TEMPLATE SB ADMIN 2 ======= -->
    <link href="template/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,800,900"
          rel="stylesheet" />
    <link href="template/css/sb-admin-2.min.css" rel="stylesheet" />

    <!-- ======= BLAZOR COMPONENT STYLES ======= -->
    <link href="EduConnect.Client.styles.css" rel="stylesheet" />
 

</head>

<body>
    <div id="app">ƒêang t·∫£i...</div>

    <!-- TinyMCE (self-hosted) -->
    <script src="lib/tinymce/tinymce.min.js"></script>
    <script src="js/tinymce-init.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // D·ªçn instance c≈© (tr√°nh l·ªói khi reload component Blazor)
            if (typeof tinymce !== 'undefined') tinymce.remove();

            // ‚úÖ Kh·ªüi t·∫°o TinyMCE
            tinymce.init({
                selector: 'textarea.tinymce',     // √Åp d·ª•ng cho m·ªçi textarea c√≥ class n√†y
                height: 400,
                menubar: true,

                // ‚úÖ X√°c nh·∫≠n d√πng GPLv2+ license (b·∫Øt bu·ªôc cho self-host)
                license_key: 'gpl',

                // ‚úÖ C√°c plugin mi·ªÖn ph√≠
                plugins: [
                    'advlist autolink lists link image charmap preview anchor',
                    'searchreplace visualblocks code fullscreen',
                    'insertdatetime media table help wordcount',
                    'emoticons autoresize paste'
                ],

                // ‚úÖ Thanh c√¥ng c·ª•
                toolbar:
                    'undo redo | blocks | bold italic underline forecolor backcolor | ' +
                    'alignleft aligncenter alignright alignjustify | ' +
                    'bullist numlist outdent indent | ' +
                    'image media link | removeformat | preview code fullscreen',

                // ‚úÖ ·∫®n logo v√† qu·∫£ng c√°o
                branding: false,
                promotion: false,

                // ‚úÖ Cho ph√©p d√°n h√¨nh ·∫£nh base64
                paste_data_images: true,
                automatic_uploads: true,
                file_picker_types: 'image',

                // ‚úÖ H√†m ch·ªçn file ·∫£nh upload th·ªß c√¥ng
                file_picker_callback: function (callback, value, meta) {
                    var input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = function () {
                        var file = this.files[0];
                        var reader = new FileReader();
                        reader.onload = function () {
                            callback(reader.result, { alt: file.name });
                        };
                        reader.readAsDataURL(file);
                    };
                    input.click();
                },

                // ‚úÖ T·ª± ƒë·ªông resize editor theo n·ªôi dung
                autoresize_bottom_margin: 20,
                min_height: 300,

                // ‚úÖ Ng√¥n ng·ªØ ti·∫øng Vi·ªát (n·∫øu b·∫°n c√≥ file vi.js trong langs/)
                language: 'vi',
                language_url: 'lib/tinymce/langs/vi.js',

                // ‚úÖ Theme + Skin (n·∫øu mu·ªën d√πng giao di·ªán s√°ng/t·ªëi t√πy √Ω)
                skin: 'oxide',
                content_css: 'default'
            });
        });

        // ‚úÖ H√†m ti·ªán √≠ch ƒë·ªÉ Blazor ƒë·ªçc n·ªôi dung TinyMCE
        window.getTinyContent = function () {
            return tinymce.activeEditor ? tinymce.activeEditor.getContent() : '';
        };
    </script>





    <script>
        window.getTinyContent = function () {
            return tinymce.activeEditor ? tinymce.activeEditor.getContent() : '';
        };
    </script>


    <!-- ============ GOOGLE SIGN-IN ============ -->
    <script src="https://accounts.google.com/gsi/client" async defer onload="initGoogle()"></script>
    <script>
        window.showModal = function (id) {
            var modal = new bootstrap.Modal(document.getElementById(id));
            modal.show();
        };

        window.hideModal = function (id) {
            var el = document.getElementById(id);
            var modal = bootstrap.Modal.getInstance(el);
            if (modal) modal.hide();
        };
    </script>

    <script>


        async function sendGoogleTokenToBackend(idToken) {
            try {
                const res = await fetch(`${API_BASE}/api/auth/google-login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ idToken })
                });
                const text = await res.text();
                try { return JSON.parse(text); }
                catch { return { status: "error", message: "Ph·∫£n h·ªìi kh√¥ng h·ª£p l·ªá t·ª´ m√°y ch·ªß" }; }
            } catch (err) {
                console.error("L·ªói k·∫øt n·ªëi:", err);
                return { status: "error", message: err.message };
            }
        }

        async function handleCredentialResponse(resp) {
            const data = await sendGoogleTokenToBackend(resp.credential);
            if (data.status === "success") {
                localStorage.setItem("access_token", data.access);
                localStorage.setItem("refresh_token", data.refresh);
                alert("üéâ ƒêƒÉng nh·∫≠p Google th√†nh c√¥ng!");
                window.location.href = "/";
            } else {
                alert("‚ùå " + (data.message || "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i"));
            }
        }

        function initGoogle() {
            const tryInit = () => {
                const div = document.getElementById("googleSignInContainer");
                if (!window.google || !div) return setTimeout(tryInit, 150);
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleCredentialResponse,
                    ux_mode: "popup"
                });
                google.accounts.id.renderButton(div, {
                    theme: "outline",
                    size: "large",
                    width: "360"
                });
            };
            tryInit();
        }

        function loadGoogleSignIn() { initGoogle(); }
    </script>
    <!-- ======================================= -->
    <!-- ======= TEMPLATE SCRIPTS (SB ADMIN 2) ======= -->
    <script src="template/vendor/jquery/jquery.min.js"></script>
    <script src="template/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="template/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="template/js/sb-admin-2.min.js"></script>
    <!--<script src="template/vendor/chart.js/Chart.min.js"></script>
    <script src="template/js/demo/chart-area-demo.js"></script>
    <script src="template/js/demo/chart-pie-demo.js"></script>

    <!-- ======= BLAZOR BOOTSTRAP ======= -->


    <script src="_framework/blazor.webassembly.js"></script>
</body>
</html>
